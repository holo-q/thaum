│ ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮ │
│ │ Caching Analysis & Optimization Plan                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                             │ │
│ │ Current Caching Situation                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                             │ │
│ │ The caching system in @Core/Cache/ already has solid foundations:                                                                                                                                           │ │
│ │                                                                                                                                                                                                             │ │
│ │ - SQLite-backed persistent cache with proper schema evolution                                                                                                                                               │ │
│ │ - Existing function optimization caching via optimization_{symbolName}_{filePath}_{line}_{level} keys                                                                                                       │ │
│ │ - Key extraction caching via key_L{level}_{hash} keys                                                                                                                                                       │ │
│ │ - Metadata tracking (prompt names, models, providers, timestamps)                                                                                                                                           │ │
│ │ - Cache invalidation patterns and compaction                                                                                                                                                                │ │
│ │                                                                                                                                                                                                             │ │
│ │ Optimization Opportunities Identified                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                             │ │
│ │ 1. Universal Module Path Identifier System                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                             │ │
│ │ Problem: Current file::name syntax is basic and lacks consistency                                                                                                                                           │ │
│ │ Solution: Design robust module identifier supporting:                                                                                                                                                       │ │
│ │ - Primary node: filepath (maintains file-first requirement)                                                                                                                                                 │ │
│ │ - Secondary nodes: namespace::class::method hierarchy                                                                                                                                                       │ │
│ │ - SHA-1 consistency mapping for renamed files                                                                                                                                                               │ │
│ │ - Example: /src/Core/Cache.cs::Thaum.Core.Services::Cache::GetAsync                                                                                                                                         │ │
│ │                                                                                                                                                                                                             │ │
│ │ 2. Optimized Function Representation Caching                                                                                                                                                                │ │
│ │                                                                                                                                                                                                             │ │
│ │ Current: Raw compression strings cached as-is                                                                                                                                                               │ │
│ │ Enhancement: Store structured optimized representations:                                                                                                                                                    │ │
│ │ - Semantic compression levels (tokens, keys, patterns)                                                                                                                                                      │ │
│ │ - Cross-reference with K1/K2 keys for enhanced retrieval                                                                                                                                                    │ │
│ │ - Compression metadata (original size, compressed size, techniques used)                                                                                                                                    │ │
│ │                                                                                                                                                                                                             │ │
│ │ 3. SHA-1 Consistency Function                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                             │ │
│ │ Purpose: Handle file renames/moves while preserving cache entries                                                                                                                                           │ │
│ │ Implementation:                                                                                                                                                                                             │ │
│ │ - Watch for file system changes                                                                                                                                                                             │ │
│ │ - Calculate SHA-1 of file contents                                                                                                                                                                          │ │
│ │ - Remap cache entries when file moves but content matches                                                                                                                                                   │ │
│ │ - Preserve optimization history across refactoring                                                                                                                                                          │ │
│ │                                                                                                                                                                                                             │ │
│ │ 4. Enhanced Retrieval by Module Path                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                             │ │
│ │ Goal: GetOptimizedSummary("file::symbolName") instant retrieval                                                                                                                                             │ │
│ │ Features:                                                                                                                                                                                                   │ │
│ │ - Fast lookups via optimized indexes                                                                                                                                                                        │ │
│ │ - Semantic similarity search across cached compressions                                                                                                                                                     │ │
│ │ - Historical compression evolution tracking                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                             │ │
│ │ Implementation Plan                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                             │ │
│ │ 1. Create ModulePathIdentifier system - robust path structure with SHA-1 mapping                                                                                                                            │ │
│ │ 2. Enhance CachedOptimization model - structured representation storage                                                                                                                                     │ │
│ │ 3. Implement consistency function - SHA-1 based cache preservation                                                                                                                                          │ │
│ │ 4. Add retrieval optimization - indexed lookups and semantic search                                                                                                                                         │ │
│ │ 5. Update cache key patterns - migrate to new identifier system                                                                                                                                             │ │
│ │ 6. Add incremental optimization - cache-aware delta compressions                                                                                                                                            │ │
│ │                                                                                                                                                                                                             │ │
│ │ This will transform the cache from simple string storage to a semantic knowledge graph of optimized function representations with robust consistency guarantees.                                            │ │
│ ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯ │
